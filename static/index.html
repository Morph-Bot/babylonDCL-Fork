<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, minimum-scale=1, width=device-width, height=device-height" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <meta name="theme-color" content="#000000" />
    <link rel="stylesheet" href="styles/index.css" />
    <link rel="preload prefetch" href="images/teleport.gif" as="image" />
  </head>
  <body>
    <audio autoplay id="voice-chat-audio"></audio>
    <div id="root"></div>
    <div id="loader-base">
      <div id="loader-text">Loading BabylonJS library...</div>
      <div id="loader-indicator" style="width: 0%; height: 20px; background-color: red;"></div>
    </div>
    <script type="text/javascript">
      ;window.addEventListener('load', function() {
        const USE_CUSTOM_VENDOR_PATH = 'http://localhost:8098'
        const libs = [
          { "name": "BabylonJS", "progress": 5, "src": "https://cdn.babylonjs.com/babylon.max.js" },
          { "name": "BabylonJS Materials library", "progress": 15, "src": "https://cdn.babylonjs.com/materialsLibrary/babylonjs.materials.js" },
          { "name": "BabylonJS 3D Asset Loading system", "progress": 20, "src": "https://cdn.babylonjs.com/loaders/babylonjs.loaders.js" },
          { "name": "BabylonJS UI system", "progress": 30, "src": "https://cdn.babylonjs.com/gui/babylon.gui.js" },
          { "name": "BabylonJS Inspector", "progress": 40, "src": "https://cdn.babylonjs.com/inspector/babylon.inspector.bundle.max.js" },
          { "name": "React", "progress": 50, "src": "https://unpkg.com/react/umd/react.development.js" },
          { "name": "ReactDOM", "progress": 65, "src": "https://unpkg.com/react-dom/umd/react-dom.development.js" },
          { "name": "xterm.js", "progress": 70, "src": "https://cdn.jsdelivr.net/npm/xterm@5.2.1/lib/xterm.js", },
          { "name": "Hammurabi", "progress": 75, "src": "js/bundle.js" }
        ];
        function load() {
          const lib = libs[0]
          document.getElementById("loader-text").innerText = "Loading " + lib.name + "...";
          document.getElementById("loader-indicator").style.width = lib.progress + "%";
          const script = document.createElement("script")
          if (USE_CUSTOM_VENDOR_PATH && lib.src.startsWith('http')) {
            const src = lib.src.split('/')
            script.src = USE_CUSTOM_VENDOR_PATH + '/' + src[src.length - 1]
          } else {
            script.src = lib.src;
          }
          script.onload = function() {
            libs.shift()
            if (libs.length > 0) {
              load()
            } else {
              document.getElementById('loader-base').style.display = 'none'
            }
          }
          script.onerror = function() {
            document.getElementById('loader-text').innerText = 'Failed to load ' + lib.name
            document.getElementById('loader-indicator').style.width = '0%'
          }
          document.querySelector('body').appendChild(script)
        }
        load()
      })
    </script>
  </body>
</html>